[["index.html", "Sleep Revolution: Sleep Apnea Cost 1 Estimating costs of sleep apnea", " Sleep Revolution: Sleep Apnea Cost Jani Miettinen, Ida Alakörkkö, Anna But &amp; Reijo Sund 1 Estimating costs of sleep apnea LAST UPDATE: 2022-04-19 08:55:00 THIS PROJECT ESTIMATES SLEEP APNEA COSTS IN EUROPE. DATA IS PUBLICLY AVAILABLE AT http://ghdx.healthdata.org/ BY CC BY-NC-ND 4.0 LICENCE. RESULTS CAN BE REPLICATED BY THIS PROJECT. # plot_europe_cost.png Sleep apnea cost can be estimated by method shown in Armeni et al. (2019) Cost-of-illness study of Obstructive Sleep Apnea Syndrome (OSAS) in Italy. This project utilize it with open data science methods. We are interested sleep apnea costs in Europe between age group of 15-74 years old. Data is collected from the year 2019. Following countries are included to the estimation: ## [1] &quot;Albania&quot; &quot;Andorra&quot; &quot;Armenia&quot; &quot;Austria&quot; &quot;Azerbaijan&quot; &quot;Belarus&quot; ## [7] &quot;Belgium&quot; &quot;Bosnia and Herzegovina&quot; &quot;Bulgaria&quot; &quot;Croatia&quot; &quot;Cyprus&quot; &quot;Czechia&quot; ## [13] &quot;Denmark&quot; &quot;Estonia&quot; &quot;Finland&quot; &quot;France&quot; &quot;Georgia&quot; &quot;Germany&quot; ## [19] &quot;Greece&quot; &quot;Hungary&quot; &quot;Iceland&quot; &quot;Ireland&quot; &quot;Italy&quot; &quot;Kazakhstan&quot; ## [25] &quot;Latvia&quot; &quot;Lithuania&quot; &quot;Luxembourg&quot; &quot;Malta&quot; &quot;Republic of Moldova&quot; &quot;Monaco&quot; ## [31] &quot;Montenegro&quot; &quot;Netherlands&quot; &quot;North Macedonia&quot; &quot;Norway&quot; &quot;Poland&quot; &quot;Portugal&quot; ## [37] &quot;Romania&quot; &quot;Russian Federation&quot; &quot;San Marino&quot; &quot;Serbia&quot; &quot;Slovakia&quot; &quot;Slovenia&quot; ## [43] &quot;Spain&quot; &quot;Sweden&quot; &quot;Switzerland&quot; &quot;Turkey&quot; &quot;Ukraine&quot; &quot;United Kingdom&quot; "],["data.html", "2 Data 2.1 Population 2.2 IHME dataset", " 2 Data Data sets to this project are publicly available and downloadable. Data sets consists of the population and disease prevalances information. It can be downloaded as (several) CSV-files. Before transferring datasets into mighty duckdb database, we find out little bit more what these data sets holds. Data can be downloaded from the links below: Population data IHME data Download data manually and store them to data/ folder. There are many csv-files so loading those can be done easily with vroom and fs packages. 2.1 Population We are interested of the population by age and gender in European countries. 2.1.1 Load data into R Load the vroom() library. Load one dataset into IHME2010 object and use the id argument to add the file name to the data frame. Use file_name as the argument’s value. Load the file spec into a variable called spec, using the spec() command. library(vroom) IHME2010 &lt;- vroom(&quot;data/IHME_GBD_2019_POP_2010_2019_SYA/IHME_GBD_2019_POP_SYA_2010_Y2021M01D28.CSV&quot;, id = &quot;file_name&quot;) spec &lt;- spec(IHME2010) spec 2.1.2 Explore dataset Explore dataset and it’s variables by summary() summary(IHME2010) rm(IHME2010) # Remove dataset from memory 2.1.3 Load and modify multiple files Load the fs and dplyr libraries. Load to a variable named files list files in the ./data/ folder using the dir_ls() function, use the glob argument to pass a wildcard to list CSV files only. library(fs) library(dplyr) loc &lt;- (&quot;data/IHME_GBD_2019_POP_2010_2019_SYA/&quot;) files &lt;- dir_ls(loc, glob = &quot;*.CSV&quot;) files Group population by location_name, year_id, sex_name, age_group_name, file_name and get the total of val and the number of items. Name them total_population and items respectively. Name the new dataset countries. Define the countries variable as NULL prior to the for loop and add a bind_rows() step to countries to preserve each summarized view. Remove the population variable at the end of each cycle. countries &lt;- NULL for(i in seq_along(files)) { population &lt;- vroom(files[i], id = &quot;file_name&quot;) countries &lt;- population %&gt;% group_by(location_name, year_id, sex_name, age_group_name, age_group_id) %&gt;% summarise(total_population = sum(val, na.rm = T)) %&gt;% bind_rows(countries) rm(population) } Preview the countries dataset by checking how many countries are in the dataset and calculating total population by year ## How many countries/locations are included? length(unique(countries$location_name)) ## Calculate countries population by year countries %&gt;% filter(sex_name == &quot;both&quot;) %&gt;% group_by(location_name, year_id, sex_name) %&gt;% summarise(pop = sum(total_population)) -&gt; countries_population head(countries_population) 2.1.4 Included European countries Below is a list of 51 European countries. See which of these countries are NOT included in population dataset europe &lt;- c(&quot;Albania&quot;,&quot;Andorra&quot;,&quot;Armenia&quot;,&quot;Austria&quot;,&quot;Azerbaijan&quot;,&quot;Belarus&quot;,&quot;Belgium&quot;,&quot;Bosnia and Herzegovina&quot;,&quot;Bulgaria&quot;,&quot;Croatia&quot;,&quot;Cyprus&quot;,&quot;Czechia&quot;,&quot;Denmark&quot;,&quot;Estonia&quot;,&quot;Finland&quot;,&quot;France&quot;,&quot;Georgia&quot;,&quot;Germany&quot;,&quot;Greece&quot;,&quot;Hungary&quot;,&quot;Iceland&quot;,&quot;Ireland&quot;,&quot;Italy&quot;,&quot;Kazakhstan&quot;,&quot;Latvia&quot;,&quot;Lithuania&quot;,&quot;Luxembourg&quot;,&quot;Malta&quot;,&quot;Republic of Moldova&quot;,&quot;Monaco&quot;,&quot;Montenegro&quot;,&quot;Netherlands&quot;,&quot;North Macedonia&quot;,&quot;Norway&quot;,&quot;Poland&quot;,&quot;Portugal&quot;,&quot;Romania&quot;,&quot;Russian Federation&quot;,&quot;San Marino&quot;,&quot;Serbia&quot;,&quot;Slovakia&quot;,&quot;Slovenia&quot;,&quot;Spain&quot;,&quot;Sweden&quot;,&quot;Switzerland&quot;,&quot;Turkey&quot;,&quot;Ukraine&quot;,&quot;United Kingdom&quot;) Create new dataset which has only europe countries and compare which are not included eucountries &lt;- countries %&gt;% filter(location_name %in% europe) ## How many European countries are included in the dataset? length(unique(eucountries$location_name)) ## These countries are missing europe[!europe %in% eucountries$location_name] 2.1.5 Europe total population in 2019 Calculate Total population in 2019 of selected European countries eucountries %&gt;% filter(sex_name == &quot;both&quot; &amp; year_id == 2019 &amp; location_name %in% europe) %&gt;% group_by(2019) %&gt;% summarise(pop = sum(total_population)) -&gt; total_population_2019 total_population_2019 2.1.6 PLOT: Finland population 2019 Draw a plot of Finland population in 2019 by age and gender ## re-adjust age_group variable of the population for filtering eucountries$age_group &lt;- eucountries$age_group_name eucountries$age_group[eucountries$age_group == &quot;&lt;1 year&quot;] &lt;- 0 eucountries$age_group[eucountries$age_group == &quot;95 plus&quot;] &lt;- 95 eucountries$age_group &lt;- as.integer(eucountries$age_group) ## plot age distribution library(ggplot2) ggplot(data = eucountries[eucountries$sex_name %in% c(&quot;female&quot;, &quot;male&quot;) &amp; eucountries$location_name == &quot;Finland&quot; &amp; eucountries$year_id == 2019, ]) + geom_bar(aes(x=age_group, y=total_population, fill=sex_name), stat = &quot;identity&quot;) + labs(x=&quot;age&quot;, y=&quot;freq&quot;, title=&quot;Finland population 2019&quot;) 2.1.7 PLOT: European countries population Filter and group dataset to get total population by years and countries eucountries %&gt;% filter(sex_name == &quot;both&quot; &amp; year_id == 2019) %&gt;% group_by(location_name, year_id) %&gt;% summarise(total_population = sum(total_population)) -&gt; populations populations$year_id &lt;- as.integer(populations$year_id) Draw ordered population bar diagram of the populations options(scipen = 999) ggplot(data = populations) + geom_bar(aes(x=reorder(location_name,total_population), y=total_population, group=year_id), position=&quot;dodge&quot;, stat=&quot;identity&quot;) + coord_flip() + labs(x=&quot;&quot;, y=&quot;population&quot;, title = &quot;Countries total population in 2019&quot;) 2.2 IHME dataset Exploring IHME dataset which is publicly available at GBD webpage. Dataset has prevalences and incidences of different disease by countries, age group and sex. You can download full dataset by this link. 2.2.1 Load few datasets Firstly load libraries library(vroom) library(fs) library(dplyr) Downloaded data is stored in data/ihmedata/. List files under the data location by using fs-package and load few files files &lt;- fs::dir_ls (&quot;data/ihmedata/&quot;, recurse = T, glob = &quot;*.csv&quot;) vroom(file = files, n_max = 1000, id = &quot;file_name&quot;) Let’s find out what two datasets has using command spec() and summary() d1 &lt;- vroom(file = files[1]) spec(d1) summary(d1) d2 &lt;- vroom(file = files[2]) spec(d2) summary(d2) Locations on each datasets length(unique(d1$location_name)) length(unique(d2$location_name)) Causes on each datasets length(unique(d1$cause_name)) length(unique(d2$cause_name)) d1 %&gt;% group_by(location_name, cause_name) %&gt;% summarise(n = n(), val=sum(val)) %&gt;% arrange(n) %&gt;% tail(10) d2 %&gt;% group_by(location_name, cause_name) %&gt;% summarise(n = n(), val=sum(val)) %&gt;% arrange(n) %&gt;% tail(10) 2.2.2 Load all datasets Load all datasets to one object and filter only Europe countries europe &lt;- c(&quot;Albania&quot;,&quot;Andorra&quot;,&quot;Armenia&quot;,&quot;Austria&quot;,&quot;Azerbaijan&quot;,&quot;Belarus&quot;,&quot;Belgium&quot;,&quot;Bosnia and Herzegovina&quot;,&quot;Bulgaria&quot;,&quot;Croatia&quot;,&quot;Cyprus&quot;,&quot;Czechia&quot;,&quot;Denmark&quot;,&quot;Estonia&quot;,&quot;Finland&quot;,&quot;France&quot;,&quot;Georgia&quot;,&quot;Germany&quot;,&quot;Greece&quot;,&quot;Hungary&quot;,&quot;Iceland&quot;,&quot;Ireland&quot;,&quot;Italy&quot;,&quot;Kazakhstan&quot;,&quot;Kosovo&quot;,&quot;Latvia&quot;,&quot;Liechtenstein&quot;,&quot;Lithuania&quot;,&quot;Luxembourg&quot;,&quot;Malta&quot;,&quot;Moldova&quot;,&quot;Monaco&quot;,&quot;Montenegro&quot;,&quot;Netherlands&quot;,&quot;North Macedonia&quot;,&quot;Norway&quot;,&quot;Poland&quot;,&quot;Portugal&quot;,&quot;Romania&quot;,&quot;Russian Federation&quot;,&quot;San Marino&quot;,&quot;Serbia&quot;,&quot;Slovakia&quot;,&quot;Slovenia&quot;,&quot;Spain&quot;,&quot;Sweden&quot;,&quot;Switzerland&quot;,&quot;Turkey&quot;,&quot;Ukraine&quot;,&quot;United Kingdom&quot;,&quot;Vatican City&quot;) ihme &lt;- NULL for(i in seq_along(files)) { ihme &lt;- ihme %&gt;% rbind(vroom(files[i], id = &quot;file_name&quot;)) %&gt;% filter(location_name %in% europe) } 2.2.3 Summary Get basic info of the dataset summary(ihme) "],["database.html", "3 Database 3.1 Load datasets 3.2 Moving data to duckdb", " 3 Database Now that we are more familiar of the datasets, let’s store files into duckdb database for further analyses. We are going to filter datasets only to include these countries: ## [1] &quot;Albania&quot; &quot;Andorra&quot; &quot;Armenia&quot; &quot;Austria&quot; &quot;Azerbaijan&quot; &quot;Belarus&quot; ## [7] &quot;Belgium&quot; &quot;Bosnia and Herzegovina&quot; &quot;Bulgaria&quot; &quot;Croatia&quot; &quot;Cyprus&quot; &quot;Czechia&quot; ## [13] &quot;Denmark&quot; &quot;Estonia&quot; &quot;Finland&quot; &quot;France&quot; &quot;Georgia&quot; &quot;Germany&quot; ## [19] &quot;Greece&quot; &quot;Hungary&quot; &quot;Iceland&quot; &quot;Ireland&quot; &quot;Italy&quot; &quot;Kazakhstan&quot; ## [25] &quot;Latvia&quot; &quot;Lithuania&quot; &quot;Luxembourg&quot; &quot;Malta&quot; &quot;Republic of Moldova&quot; &quot;Monaco&quot; ## [31] &quot;Montenegro&quot; &quot;Netherlands&quot; &quot;North Macedonia&quot; &quot;Norway&quot; &quot;Poland&quot; &quot;Portugal&quot; ## [37] &quot;Romania&quot; &quot;Russian Federation&quot; &quot;San Marino&quot; &quot;Serbia&quot; &quot;Slovakia&quot; &quot;Slovenia&quot; ## [43] &quot;Spain&quot; &quot;Sweden&quot; &quot;Switzerland&quot; &quot;Turkey&quot; &quot;Ukraine&quot; &quot;United Kingdom&quot; First load necessary packages library(fs) library(dplyr) library(vroom) library(readxl) 3.1 Load datasets 3.1.1 Population dataset Population dataset is in folder data/IHME_GBD_2019_POP_2010_2019_SYA/. Let’s load all file locations loc &lt;- (&quot;data/IHME_GBD_2019_POP_2010_2019_SYA/&quot;) files &lt;- dir_ls(loc, glob = &quot;*.CSV&quot;) files Load all files and clean the dataset POP &lt;- NULL for(i in seq_along(files)) { population &lt;- vroom(files[i], id = &quot;file_name&quot;) POP &lt;- population %&gt;% group_by(location_name, year_id, sex_name, age_group_name, age_group_id) %&gt;% summarise(total_population = sum(val, na.rm = T)) %&gt;% bind_rows(POP) rm(population) } ## create a new age_group variable by re-adjusting age_group_name variable to integer unique(POP$age_group_name) POP$age_group &lt;- POP$age_group_name POP$age_group[POP$age_group == &quot;&lt;1 year&quot;] &lt;- 0 POP$age_group[POP$age_group == &quot;95 plus&quot;] &lt;- 95 POP$age_group &lt;- as.integer(POP$age_group) ## filter only europe countries POP &lt;- POP %&gt;% filter(location_name %in% europe) ## Change location_names to universal ## change original to this: &quot;Bosnia and Herz.&quot;&gt; &quot;Bosnia and Herzegovina&quot; ## change original to this: Czechia&quot; &gt; (&quot;Czech Rep.&quot;) &gt; &quot;Czech Republic&quot; ## change original to this: &quot;Russian Federation&quot; &gt; &quot;Russia&quot; ## change original to this: &quot;North Macedonia&quot; &gt; &quot;Macedonia&quot; ## change original to this: &quot;Republic of Moldova&quot; &gt; &quot;Moldova&quot; # unique(POP$location_name) # POP[POP$location_name == &quot;Bosnia and Herz.&quot;,] &lt;- &quot;Bosnia and Herzegovina&quot; POP$location_name[POP$location_name == &quot;Czechia&quot;] &lt;- &quot;Czech Republic&quot; POP$location_name[POP$location_name == &quot;Russian Federation&quot;] &lt;- &quot;Russia&quot; POP$location_name[POP$location_name == &quot;North Macedonia&quot;] &lt;- &quot;Macedonia&quot; POP$location_name[POP$location_name == &quot;Republic of Moldova&quot;] &lt;- &quot;Moldova&quot; Calculate Total population in 2019 of selected European countries ## Calculate Total population in 2019 of selected European countries POP %&gt;% filter(sex_name == &quot;both&quot; &amp; year_id == 2019) %&gt;% group_by(2019) %&gt;% summarise(pop = sum(total_population)) -&gt; total_population_2019 total_population_2019 3.1.2 IHME dataset Datasets are in folder data/ihmedata/. Load all the file location into a object. files &lt;- fs::dir_ls (&quot;data/ihmedata/&quot;, recurse = T, glob = &quot;*.csv&quot;) # files Load all files and filter only European countries IHME &lt;- NULL for(i in seq_along(files)) { IHME &lt;- IHME %&gt;% rbind(vroom(files[i], id = &quot;file_name&quot;)) %&gt;% filter(location_name %in% europe) } 3.1.3 Calculator files We have included a Excel file which holds data for the calculator. These data are taken from the article Ameni et al. (2019) Cost-of-illness study of Obstructive Sleep Apnea Syndrome (OSAS) in Italy tbl1 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl1&quot;) tbl2 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl2&quot;) 3.2 Moving data to duckdb In this section we move created datasets to duckdb database and trasform to parquet file. Further reading: https://duckdb.org/docs/api/r https://duckdb.org/2021/12/03/duck-arrow.html Firstly install duckdb and arrow packages install.packages(&quot;duckdb&quot;) install.packages(&quot;arrow&quot;) Create a connection and move datasets POP and IHME into duckdb. library(duckdb) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22.duckdb&quot;, read_only=FALSE) dbWriteTable(con, &quot;IHME&quot;, IHME, overwrite=TRUE) dbWriteTable(con, &quot;POP&quot;, POP, overwrite=TRUE) dbWriteTable(con, &quot;slapnea&quot;, tbl1, overwrite=TRUE) dbWriteTable(con, &quot;paf&quot;, tbl2, overwrite=TRUE) dbDisconnect(conn = con) 3.2.1 Transform to parquet Transform whole database to parquet file system con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22.duckdb&quot;, read_only=FALSE) if(dir.exists(&quot;data/parquet/&quot;)) fs::dir_delete(&quot;data/parquet/&quot;) if(!dir.exists(&quot;data/parquet/&quot;)) dir.create(&quot;data/parquet/&quot;) dbSendQuery(con, &quot;EXPORT DATABASE &#39;data/parquet/&#39; (FORMAT PARQUET);&quot;) dbDisconnect(conn = con) "],["explorative-data-analysis.html", "4 Explorative Data Analysis 4.1 HME distinct values 4.2 PLOT: Population in countries 4.3 PLOT: Finland population 2019 4.4 TABLE: Prevalences 4.5 TABLE: Incidences 4.6 TABLE: Deaths 4.7 TABLE: Prevalences per countries", " 4 Explorative Data Analysis ## Loading required package: DBI ## ## Attaching package: &#39;arrow&#39; ## The following object is masked from &#39;package:utils&#39;: ## ## timestamp 4.1 HME distinct values 4.1.1 measure_name ## measure_name ## 1 Prevalence ## 2 Incidence ## 3 Deaths 4.1.2 sex_name ## sex_name ## 1 Male ## 2 Female ## 3 Both 4.1.3 age_name ## age_name ## 1 80 to 84 ## 2 85 to 89 ## 3 90 to 94 ## 4 95 plus ## 5 Under 5 ## 6 5 to 9 ## 7 10 to 14 ## 8 15 to 19 ## 9 20 to 24 ## 10 25 to 29 ## 11 30 to 34 ## 12 35 to 39 ## 13 40 to 44 ## 14 45 to 49 ## 15 50 to 54 ## 16 55 to 59 ## 17 60 to 64 ## 18 65 to 69 ## 19 70 to 74 ## 20 75 to 79 4.1.4 metric_name ## metric_name ## 1 Rate ## 2 Number ## 3 Percent 4.1.5 year ## year ## 1 2019 4.1.6 cause_name ## cause_id cause_name ## 1 294 All causes ## 2 295 Communicable, maternal, neonatal, and nutritional diseases ## 3 297 Tuberculosis ## 4 298 HIV/AIDS ## 5 300 HIV/AIDS resulting in other diseases ## 6 302 Diarrheal diseases ## 7 319 Typhoid fever ## 8 320 Paratyphoid fever ## 9 321 Other intestinal infectious diseases ## 10 322 Lower respiratory infections ## 11 328 Upper respiratory infections ## 12 329 Otitis media ## 13 332 Meningitis ## 14 337 Encephalitis ## 15 338 Diphtheria ## 16 339 Whooping cough ## 17 340 Tetanus ## 18 341 Measles ## 19 342 Varicella and herpes zoster ## 20 344 Neglected tropical diseases and malaria ## 21 345 Malaria ## 22 346 Chagas disease ## 23 347 Leishmaniasis ## 24 348 Visceral leishmaniasis ## 25 349 Cutaneous and mucocutaneous leishmaniasis ## 26 350 African trypanosomiasis ## 27 351 Schistosomiasis ## 28 352 Cysticercosis ## 29 353 Cystic echinococcosis ## 30 354 Lymphatic filariasis ## 31 355 Onchocerciasis ## 32 356 Trachoma ## 33 357 Dengue ## 34 358 Yellow fever ## 35 359 Rabies ## 36 360 Intestinal nematode infections ## 37 361 Ascariasis ## 38 362 Trichuriasis ## 39 363 Hookworm disease ## 40 364 Food-borne trematodiases ## 41 365 Other neglected tropical diseases ## 42 366 Maternal disorders ## 43 367 Maternal hemorrhage ## 44 368 Maternal sepsis and other maternal infections ## 45 369 Maternal hypertensive disorders ## 46 370 Maternal obstructed labor and uterine rupture ## 47 374 Ectopic pregnancy ## 48 375 Indirect maternal deaths ## 49 376 Late maternal deaths ## 50 379 Other maternal disorders ## 51 380 Neonatal disorders ## 52 381 Neonatal preterm birth ## 53 382 Neonatal encephalopathy due to birth asphyxia and trauma ## 54 383 Neonatal sepsis and other neonatal infections ## 55 384 Hemolytic disease and other neonatal jaundice ## 56 385 Other neonatal disorders ## 57 386 Nutritional deficiencies ## 58 387 Protein-energy malnutrition ## 59 388 Iodine deficiency ## 60 389 Vitamin A deficiency ## 61 390 Dietary iron deficiency ## 62 391 Other nutritional deficiencies ## 63 393 Sexually transmitted infections excluding HIV ## 64 394 Syphilis ## 65 395 Chlamydial infection ## 66 396 Gonococcal infection ## 67 397 Trichomoniasis ## 68 398 Genital herpes ## 69 399 Other sexually transmitted infections ## 70 400 Acute hepatitis ## 71 401 Acute hepatitis A ## 72 402 Acute hepatitis B ## 73 403 Acute hepatitis C ## 74 404 Acute hepatitis E ## 75 405 Leprosy ## 76 408 Other unspecified infectious diseases ## 77 409 Non-communicable diseases ## 78 410 Neoplasms ## 79 411 Esophageal cancer ## 80 414 Stomach cancer ## 81 417 Liver cancer ## 82 418 Liver cancer due to hepatitis B ## 83 419 Liver cancer due to hepatitis C ## 84 420 Liver cancer due to alcohol use ## 85 423 Larynx cancer ## 86 426 Tracheal, bronchus, and lung cancer ## 87 429 Breast cancer ## 88 432 Cervical cancer ## 89 435 Uterine cancer ## 90 438 Prostate cancer ## 91 441 Colon and rectum cancer ## 92 444 Lip and oral cavity cancer ## 93 447 Nasopharynx cancer ## 94 450 Other pharynx cancer ## 95 453 Gallbladder and biliary tract cancer ## 96 456 Pancreatic cancer ## 97 459 Malignant skin melanoma ## 98 462 Non-melanoma skin cancer ## 99 465 Ovarian cancer ## 100 468 Testicular cancer ## 101 471 Kidney cancer ## 102 474 Bladder cancer ## 103 477 Brain and central nervous system cancer ## 104 480 Thyroid cancer ## 105 483 Mesothelioma ## 106 484 Hodgkin lymphoma ## 107 485 Non-Hodgkin lymphoma ## 108 486 Multiple myeloma ## 109 487 Leukemia ## 110 490 Other neoplasms ## 111 491 Cardiovascular diseases ## 112 492 Rheumatic heart disease ## 113 493 Ischemic heart disease ## 114 494 Stroke ## 115 495 Ischemic stroke ## 116 496 Intracerebral hemorrhage ## 117 497 Subarachnoid hemorrhage ## 118 498 Hypertensive heart disease ## 119 499 Cardiomyopathy and myocarditis ## 120 500 Atrial fibrillation and flutter ## 121 501 Aortic aneurysm ## 122 502 Peripheral artery disease ## 123 503 Endocarditis ## 124 504 Non-rheumatic valvular heart disease ## 125 508 Chronic respiratory diseases ## 126 509 Chronic obstructive pulmonary disease ## 127 510 Pneumoconiosis ## 128 511 Silicosis ## 129 512 Asbestosis ## 130 513 Coal workers pneumoconiosis ## 131 514 Other pneumoconiosis ## 132 515 Asthma ## 133 516 Interstitial lung disease and pulmonary sarcoidosis ## 134 520 Other chronic respiratory diseases ## 135 521 Cirrhosis and other chronic liver diseases ## 136 522 Cirrhosis and other chronic liver diseases due to hepatitis B ## 137 523 Cirrhosis and other chronic liver diseases due to hepatitis C ## 138 524 Cirrhosis and other chronic liver diseases due to alcohol use ## 139 525 Cirrhosis and other chronic liver diseases due to other causes ## 140 526 Digestive diseases ## 141 527 Peptic ulcer disease ## 142 528 Gastritis and duodenitis ## 143 529 Appendicitis ## 144 530 Paralytic ileus and intestinal obstruction ## 145 531 Inguinal, femoral, and abdominal hernia ## 146 532 Inflammatory bowel disease ## 147 533 Vascular intestinal disorders ## 148 534 Gallbladder and biliary diseases ## 149 535 Pancreatitis ## 150 536 Gastroesophageal reflux disease ## 151 541 Other digestive diseases ## 152 542 Neurological disorders ## 153 543 Alzheimer&#39;s disease and other dementias ## 154 544 Parkinson&#39;s disease ## 155 545 Idiopathic epilepsy ## 156 546 Multiple sclerosis ## 157 547 Migraine ## 158 548 Tension-type headache ## 159 554 Motor neuron disease ## 160 557 Other neurological disorders ## 161 558 Mental disorders ## 162 559 Schizophrenia ## 163 560 Alcohol use disorders ## 164 561 Drug use disorders ## 165 562 Opioid use disorders ## 166 563 Cocaine use disorders ## 167 564 Amphetamine use disorders ## 168 565 Cannabis use disorders ## 169 566 Other drug use disorders ## 170 567 Depressive disorders ## 171 568 Major depressive disorder ## 172 569 Dysthymia ## 173 570 Bipolar disorder ## 174 571 Anxiety disorders ## 175 572 Eating disorders ## 176 573 Anorexia nervosa ## 177 574 Bulimia nervosa ## 178 575 Autism spectrum disorders ## 179 578 Attention-deficit/hyperactivity disorder ## 180 579 Conduct disorder ## 181 582 Idiopathic developmental intellectual disability ## 182 585 Other mental disorders ## 183 587 Diabetes mellitus ## 184 588 Acute glomerulonephritis ## 185 589 Chronic kidney disease ## 186 591 Chronic kidney disease due to hypertension ## 187 592 Chronic kidney disease due to glomerulonephritis ## 188 593 Chronic kidney disease due to other and unspecified causes ## 189 594 Urinary diseases and male infertility ## 190 595 Urinary tract infections and interstitial nephritis ## 191 596 Urolithiasis ## 192 597 Benign prostatic hyperplasia ## 193 598 Male infertility ## 194 602 Other urinary diseases ## 195 603 Gynecological diseases ## 196 604 Uterine fibroids ## 197 605 Polycystic ovarian syndrome ## 198 606 Female infertility ## 199 607 Endometriosis ## 200 608 Genital prolapse ## 201 609 Premenstrual syndrome ## 202 612 Other gynecological diseases ## 203 613 Hemoglobinopathies and hemolytic anemias ## 204 614 Thalassemias ## 205 615 Sickle cell disorders ## 206 616 G6PD deficiency ## 207 618 Other hemoglobinopathies and hemolytic anemias ## 208 619 Endocrine, metabolic, blood, and immune disorders ## 209 626 Musculoskeletal disorders ## 210 627 Rheumatoid arthritis ## 211 628 Osteoarthritis ## 212 630 Low back pain ## 213 631 Neck pain ## 214 632 Gout ## 215 639 Other musculoskeletal disorders ## 216 640 Other non-communicable diseases ## 217 641 Congenital birth defects ## 218 642 Neural tube defects ## 219 643 Congenital heart anomalies ## 220 644 Orofacial clefts ## 221 645 Down syndrome ## 222 646 Turner syndrome ## 223 647 Klinefelter syndrome ## 224 648 Other chromosomal abnormalities ## 225 649 Congenital musculoskeletal and limb anomalies ## 226 650 Urogenital congenital anomalies ## 227 651 Digestive congenital anomalies ## 228 652 Other congenital birth defects ## 229 653 Skin and subcutaneous diseases ## 230 654 Dermatitis ## 231 655 Psoriasis ## 232 656 Cellulitis ## 233 657 Pyoderma ## 234 658 Scabies ## 235 659 Fungal skin diseases ## 236 660 Viral skin diseases ## 237 661 Acne vulgaris ## 238 662 Alopecia areata ## 239 663 Pruritus ## 240 664 Urticaria ## 241 665 Decubitus ulcer ## 242 668 Other skin and subcutaneous diseases ## 243 669 Sense organ diseases ## 244 670 Glaucoma ## 245 671 Cataract ## 246 672 Age-related macular degeneration ## 247 674 Age-related and other hearing loss ## 248 675 Other vision loss ## 249 679 Other sense organ diseases ## 250 680 Oral disorders ## 251 681 Caries of deciduous teeth ## 252 682 Caries of permanent teeth ## 253 683 Periodontal diseases ## 254 684 Edentulism ## 255 685 Other oral disorders ## 256 686 Sudden infant death syndrome ## 257 687 Injuries ## 258 688 Transport injuries ## 259 689 Road injuries ## 260 690 Pedestrian road injuries ## 261 691 Cyclist road injuries ## 262 692 Motorcyclist road injuries ## 263 693 Motor vehicle road injuries ## 264 694 Other road injuries ## 265 695 Other transport injuries ## 266 696 Unintentional injuries ## 267 697 Falls ## 268 698 Drowning ## 269 699 Fire, heat, and hot substances ## 270 700 Poisonings ## 271 701 Poisoning by carbon monoxide ## 272 703 Poisoning by other means ## 273 704 Exposure to mechanical forces ## 274 705 Unintentional firearm injuries ## 275 707 Other exposure to mechanical forces ## 276 708 Adverse effects of medical treatment ## 277 709 Animal contact ## 278 710 Venomous animal contact ## 279 711 Non-venomous animal contact ## 280 712 Foreign body ## 281 713 Pulmonary aspiration and foreign body in airway ## 282 714 Foreign body in eyes ## 283 715 Foreign body in other body part ## 284 716 Other unintentional injuries ## 285 717 Self-harm and interpersonal violence ## 286 718 Self-harm ## 287 721 Self-harm by firearm ## 288 723 Self-harm by other specified means ## 289 724 Interpersonal violence ## 290 725 Physical violence by firearm ## 291 726 Physical violence by sharp object ## 292 727 Physical violence by other means ## 293 729 Exposure to forces of nature ## 294 741 Maternal deaths aggravated by HIV/AIDS ## 295 837 Thalassemias trait ## 296 838 Sickle cell trait ## 297 839 G6PD trait ## 298 842 Environmental heat and cold exposure ## 299 843 Ebola ## 300 845 Acute lymphoid leukemia ## 301 846 Chronic lymphoid leukemia ## 302 847 Acute myeloid leukemia ## 303 848 Chronic myeloid leukemia ## 304 849 Non-melanoma skin cancer (squamous-cell carcinoma) ## 305 850 Non-melanoma skin cancer (basal-cell carcinoma) ## 306 854 Executions and police conflict ## 307 934 Drug-susceptible tuberculosis ## 308 935 Zika virus ## 309 936 Guinea worm disease ## 310 938 Alcoholic cardiomyopathy ## 311 941 Sexual violence ## 312 942 Myocarditis ## 313 943 Other leukemia ## 314 944 Other cardiomyopathy ## 315 945 Conflict and terrorism ## 316 946 Multidrug-resistant tuberculosis without extensive drug resistance ## 317 947 Extensively drug-resistant tuberculosis ## 318 948 HIV/AIDS - Drug-susceptible Tuberculosis ## 319 949 HIV/AIDS - Multidrug-resistant Tuberculosis without extensive drug resistance ## 320 950 HIV/AIDS - Extensively drug-resistant Tuberculosis ## 321 954 Latent tuberculosis infection ## 322 955 HIV/AIDS and sexually transmitted infections ## 323 956 Respiratory infections and tuberculosis ## 324 957 Enteric infections ## 325 958 Typhoid and paratyphoid ## 326 959 Invasive Non-typhoidal Salmonella (iNTS) ## 327 961 Other infectious diseases ## 328 962 Maternal and neonatal disorders ## 329 964 Myelodysplastic, myeloproliferative, and other hematopoietic neoplasms ## 330 965 Benign and in situ intestinal neoplasms ## 331 966 Benign and in situ cervical and uterine neoplasms ## 332 967 Other benign and in situ neoplasms ## 333 968 Non-rheumatic calcific aortic valve disease ## 334 969 Non-rheumatic degenerative mitral valve disease ## 335 970 Other non-rheumatic valve diseases ## 336 971 Cirrhosis and other chronic liver diseases due to NAFLD ## 337 972 Headache disorders ## 338 973 Substance use disorders ## 339 974 Diabetes and kidney diseases ## 340 975 Diabetes mellitus type 1 ## 341 976 Diabetes mellitus type 2 ## 342 977 Atopic dermatitis ## 343 978 Contact dermatitis ## 344 979 Seborrhoeic dermatitis ## 345 980 Bacterial skin diseases ## 346 981 Blindness and vision loss ## 347 992 Upper digestive system diseases ## 348 995 Maternal abortion and miscarriage ## 349 996 Liver cancer due to NASH ## 350 997 Chronic kidney disease due to diabetes mellitus type 1 ## 351 998 Chronic kidney disease due to diabetes mellitus type 2 ## 352 999 Refraction disorders ## 353 1000 Near vision loss ## 354 1014 Osteoarthritis hip ## 355 1015 Osteoarthritis knee ## 356 1016 Osteoarthritis hand ## 357 1017 Osteoarthritis other ## 358 1021 Liver cancer due to other causes ## 359 1022 Other malignant neoplasms ## 360 1023 Other cardiovascular and circulatory diseases ## 361 1026 Total burden related to hepatitis B ## 362 1027 Total burden related to hepatitis C ## 363 1028 Total burden related to Non-alcoholic fatty liver disease (NAFLD) ## 364 1029 Total cancers 4.1.7 Calculator datas ## # A tibble: 27 × 8 ## cause_id type Conditon PAF prevalence_base_italy annual_direct_healthcare_cost annual_direct_nonhealthcare_co… annual_producti… ## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 294 mortality All-cause mortality Severe 0.075 0.003 NA NA NA ## 2 1023 mortality Cardiovascular mortality Severe 0.227 NA NA NA NA ## 3 1029 prevalence Cancer Overall 0.097 0.042 5718 4581 119 ## 4 NA prevalence Diabetic retinopathy Overall* 0.207 0.026 307 242 579 ## 5 998 prevalence Diabetic kidney disease Overall* 0.135 0.015 797 NA NA ## 6 976 prevalence Type 2 diabetes 0.145 0.068 3866 NA 4352 ## 7 619 prevalence Metabolic syndrome (mild) 0.164 0.33 1900 NA 90 ## 8 NA prevalence Metabolic syndrome (moderate-severe) 0.232 NA NA NA NA ## 9 NA prevalence Erectile dysfunction 0.228 0.1 407 NA NA ## 10 NA prevalence Female sexual dysfunction 0.153 0.29 761 NA NA ## # … with 17 more rows ## # A tibble: 6 × 4 ## var label gender rate ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Mild Mild (5≤AHI&lt;15) Female 0.29 ## 2 Moderate Moderate (15≤AHI&lt;30) Female 0.1 ## 3 Severe Severe (AHI≥30) Female 0.09 ## 4 Mild Mild (5≤AHI&lt;15) Male 0.25 ## 5 Moderate Moderate (15≤AHI&lt;30 Male 0.14 ## 6 Severe Severe (AHI≥30) Male 0.22 4.2 PLOT: Population in countries ## Warning: Missing values are always removed in SQL. ## Use `SUM(x, na.rm = TRUE)` to silence this warning ## This warning is displayed only once per session. ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. Figure 4.1: Countries population in 2019. 4.3 PLOT: Finland population 2019 Draw Finland population in 2019 ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. Figure 4.2: Countries population in 2019. 4.4 TABLE: Prevalences Create a table of all prevalences of disease available in the dataset from year 2019. ## `summarise()` has grouped output by &#39;cause_id&#39;. You can override using the `.groups` argument. 4.5 TABLE: Incidences Create a table of all Incidence of disease available in the dataset from year 2019. ## `summarise()` has grouped output by &#39;cause_id&#39;. You can override using the `.groups` argument. 4.6 TABLE: Deaths Create a table of all Incidence of disease available in the dataset from year 2019. ## `summarise()` has grouped output by &#39;cause_id&#39;. You can override using the `.groups` argument. 4.7 TABLE: Prevalences per countries Group prevalences by countries and calculate percentage of the population (15-74 years old). ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. ## [1] 48 ## [1] 359 Disconnect "],["calculations.html", "5 Calculations 5.1 Prevalences from ihme 5.2 Population from ihme 5.3 Prevalences from ihme dataset 5.4 Mortalities from ihme 5.5 Combining with base values 5.6 Table: prevalences and mortalities 5.7 Save data to new database 5.8 Costs 5.9 Validation", " 5 Calculations In this chapter we are going to calculate prevalences and mortalities from ihme datasets. These values are needed for estimating costs of sleep apnea direct healthcare, direct nonhealthcare and productivity losses costs. Data is filtered: Age 15-74 years old European countries 5.1 Prevalences from ihme Prevalence Base values are given in 1_paf.parquet file. Join country specific prevalences which we can get from ihme data. library(duckdb) library(arrow) library(dplyr) # # Reads Parquet File to an Arrow Table # arrow_paf &lt;- arrow::read_parquet(&quot;data/parquet/0_paf.parquet&quot;, as_data_frame = FALSE) # arrow_slapnea &lt;- arrow::read_parquet(&quot;data/parquet/1_slapnea.parquet&quot;, as_data_frame = FALSE) # arrow_pop &lt;- arrow::read_parquet(&quot;data/parquet/2_pop.parquet&quot;, as_data_frame = FALSE) # arrow_ihme &lt;- arrow::read_parquet(&quot;data/parquet/3_ihme.parquet&quot;, as_data_frame = FALSE) # # # Gets Database Connection # con &lt;- dbConnect(duckdb::duckdb()) # # Registers arrow table as a DuckDB view # arrow::to_duckdb(arrow_slapnea, table_name = &quot;slapnea&quot;, con = con) # arrow::to_duckdb(arrow_paf, table_name = &quot;paf&quot;, con = con) # arrow::to_duckdb(arrow_ihme, table_name = &quot;ihme&quot;, con = con) # arrow::to_duckdb(arrow_pop, table_name = &quot;pop&quot;, con = con) # ## Check tables # duckdb::dbListTables(con) # duckdb::dbListFields(con, &quot;slapnea&quot;) # duckdb::dbListFields(con, &quot;paf&quot;) # duckdb::dbListFields(con, &quot;ihme&quot;) # duckdb::dbListFields(con, &quot;pop&quot;) con &lt;- dbConnect(duckdb::duckdb(), dbdir=&quot;data/sleep22.duckdb&quot;, read_only=TRUE) 5.2 Population from ihme Calculating 15-74 years old population of the countries ## Both, female and male population (15-74yrs) in wide format library(tidyr) tbl(con, &quot;pop&quot;) %&gt;% filter(age_group &gt; 14 &amp; age_group &lt; 75 &amp; year_id == 2019) %&gt;% group_by(location_name, sex_name) %&gt;% summarise(pop = sum(total_population)) %&gt;% collect() %&gt;% pivot_wider(names_from = sex_name, values_from = pop) %&gt;% rename(pop_both = both, pop_female = female, pop_male = male) -&gt; population_age_filtered ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. head(population_age_filtered) ## # A tibble: 6 × 4 ## # Groups: location_name [6] ## location_name pop_both pop_female pop_male ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Albania 2085677. 1042814. 1042863. ## 2 Andorra 67016. 32263. 34752. ## 3 Armenia 2267463. 1187751. 1079711. ## 4 Austria 6785345. 3390812. 3394534. ## 5 Azerbaijan 7752896. 3933115. 3819781. ## 6 Belarus 7249252. 3828210. 3421042. 5.3 Prevalences from ihme dataset Calculating prevalences percentages by joining prevalences and population information ## Get cause_id&#39;s which base values we can use to overwrite from IHME data tbl(con, &quot;paf&quot;) %&gt;% filter(type == &quot;prevalence&quot;) %&gt;% # TODO check if this is right! select(cause_id) %&gt;% collect() -&gt; causes causes &lt;- causes$cause_id[!is.na(causes$cause_id)] ## Get number of prevalences per location and causes from IHME (age: 15-74 and sex: both) tbl(con, &quot;ihme&quot;) %&gt;% filter(cause_id %in% causes &amp; metric_name == &quot;Number&quot; &amp; age_id &gt; 7 &amp; age_id &lt; 20 &amp; sex_id == 3) %&gt;% group_by(location_name, cause_id, cause_name) %&gt;% summarise(prevalence_number = sum(val)) %&gt;% arrange(location_name, cause_id) %&gt;% collect() -&gt; prevalences_ihme ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;cause_id&#39;. You can override using the `.groups` argument. ## Calculate Rates: join tables prevalences_ihme &amp; population_age_filtered prevalences_ihme %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) %&gt;% mutate(prevalence = prevalence_number / pop_both) %&gt;% select(location_name, cause_id, cause_name, prevalence) -&gt; prevalences_ihme head(prevalences_ihme) ## # A tibble: 6 × 4 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name prevalence ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 369 Maternal hypertensive disorders 0.00142 ## 2 Albania 493 Ischemic heart disease 0.0376 ## 3 Albania 494 Stroke 0.0168 ## 4 Albania 536 Gastroesophageal reflux disease 0.137 ## 5 Albania 619 Endocrine, metabolic, blood, and immune disorders 0.0919 ## 6 Albania 670 Glaucoma 0.000380 5.4 Mortalities from ihme Calculating mortalities for two diseases and calculating percentages by joining mortality and population information 1023 Other cardiovascular and circulatory diseases 294 All causes ## Get cause_id&#39;s which base values we can use to overwrite from IHME data tbl(con, &quot;paf&quot;) %&gt;% filter(type == &quot;mortality&quot;) %&gt;% select(cause_id) %&gt;% collect() -&gt; causes causes &lt;- causes$cause_id[!is.na(causes$cause_id)] ## Get mortality values from ihme tbl(con, &quot;ihme&quot;) %&gt;% filter(cause_id %in% causes &amp; measure_name == &quot;Deaths&quot; &amp; metric_name == &quot;Number&quot; &amp; age_id &gt; 7 &amp; age_id &lt; 20 &amp; sex_id == 3) %&gt;% group_by(location_name, cause_id, cause_name) %&gt;% summarise(mortality_number = sum(val)) %&gt;% arrange(location_name, cause_id) %&gt;% collect() -&gt; mortalities_ihme ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;cause_id&#39;. You can override using the `.groups` argument. ## Calculate Rates: join tables mortalities_ihme &amp; population_age_filtered mortalities_ihme %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) %&gt;% mutate(mortality = mortality_number / pop_both) %&gt;% select(location_name, cause_id, cause_name, mortality) -&gt; mortalities_ihme head(mortalities_ihme) ## # A tibble: 6 × 4 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name mortality ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 294 All causes 0.00423 ## 2 Albania 1023 Other cardiovascular and circulatory diseases 0.0000757 ## 3 Andorra 294 All causes 0.00351 ## 4 Andorra 1023 Other cardiovascular and circulatory diseases 0.0000173 ## 5 Armenia 294 All causes 0.00573 ## 6 Armenia 1023 Other cardiovascular and circulatory diseases 0.0000190 ## Join mortalities and prevalance data. Rename &#39;mortality&#39;/&#39;prevalence&#39; to &#39;value&#39;. ihme &lt;- prevalences_ihme %&gt;% rbind(mortalities_ihme) %&gt;% mutate(value = ifelse(is.na(prevalence), mortality, prevalence)) %&gt;% select(location_name, cause_id, cause_name, value) %&gt;% arrange(location_name, cause_id) head(ihme) ## # A tibble: 6 × 4 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name value ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 294 All causes 0.00423 ## 2 Albania 369 Maternal hypertensive disorders 0.00142 ## 3 Albania 493 Ischemic heart disease 0.0376 ## 4 Albania 494 Stroke 0.0168 ## 5 Albania 536 Gastroesophageal reflux disease 0.137 ## 6 Albania 619 Endocrine, metabolic, blood, and immune disorders 0.0919 5.5 Combining with base values Base data (from excel) and country specific prevalences &amp; mortalities ## Base data. We need paf info for every country prevalences_base &lt;- NULL for(cntry in unique(ihme$location_name)){ # print(cntry) tbl(con, &quot;paf&quot;) %&gt;% collect() %&gt;% mutate(location_name = cntry, condition = Conditon) %&gt;% select(&quot;location_name&quot;, &quot;cause_id&quot;, &quot;condition&quot;, &quot;PAF&quot;, &quot;prevalence_base_italy&quot;, &quot;annual_direct_healthcare_cost&quot;, &quot;annual_direct_nonhealthcare_cost&quot;, &quot;annual_productivity_losses_cost&quot;) %&gt;% rbind(prevalences_base) -&gt; prevalences_base } head(prevalences_base) ## # A tibble: 6 × 8 ## location_name cause_id condition PAF prevalence_base_italy annual_direct_healthcare_cost annual_direct_nonhealthcare_cost annual_producti… ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 United Kingdom 294 All-cause mortality Severe 0.075 0.003 NA NA NA ## 2 United Kingdom 1023 Cardiovascular mortality Severe 0.227 NA NA NA NA ## 3 United Kingdom 1029 Cancer Overall 0.097 0.042 5718 4581 119 ## 4 United Kingdom NA Diabetic retinopathy Overall* 0.207 0.026 307 242 579 ## 5 United Kingdom 998 Diabetic kidney disease Overall* 0.135 0.015 797 NA NA ## 6 United Kingdom 976 Type 2 diabetes 0.145 0.068 3866 NA 4352 With base values, join new calculated prevalences/mortalities from IHME ## Join base data and new calculated prevalences prevalences_final &lt;- prevalences_base %&gt;% left_join(ihme, by = c(&quot;location_name&quot;, &quot;cause_id&quot;)) %&gt;% mutate(value = ifelse(is.na(value), prevalence_base_italy, value)) %&gt;% select(location_name, cause_id, cause_name, condition, PAF, value, prevalence_base_italy, annual_direct_healthcare_cost, annual_direct_nonhealthcare_cost, annual_productivity_losses_cost) %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) ## Add the population to all rows head(prevalences_final) ## # A tibble: 6 × 13 ## location_name cause_id cause_name condition PAF value prevalence_base… annual_direct_h… annual_direct_n… annual_producti… pop_both pop_female pop_male ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 United Kingdom 294 All causes All-caus… 0.075 4.02e-3 0.003 NA NA NA 4.99e7 25024325. 2.48e7 ## 2 United Kingdom 1023 Other cardiovascul… Cardiova… 0.227 4.97e-5 NA NA NA NA 4.99e7 25024325. 2.48e7 ## 3 United Kingdom 1029 Total cancers Cancer O… 0.097 3.80e-2 0.042 5718 4581 119 4.99e7 25024325. 2.48e7 ## 4 United Kingdom NA &lt;NA&gt; Diabetic… 0.207 2.6 e-2 0.026 307 242 579 4.99e7 25024325. 2.48e7 ## 5 United Kingdom 998 Chronic kidney dis… Diabetic… 0.135 1.28e-2 0.015 797 NA NA 4.99e7 25024325. 2.48e7 ## 6 United Kingdom 976 Diabetes mellitus … Type 2 d… 0.145 1.32e-1 0.068 3866 NA 4352 4.99e7 25024325. 2.48e7 5.6 Table: prevalences and mortalities DT::datatable(prevalences_final, rownames = FALSE) ## Read from source excel tbl1 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl1&quot;) tbl2 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl2&quot;) dbDisconnect(con, shutdown=TRUE) 5.7 Save data to new database library(duckdb) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_prevalences.duckdb&quot;, read_only=FALSE) dbWriteTable(con, &quot;prevalences&quot;, prevalences_final, overwrite=TRUE) dbWriteTable(con, &quot;slapnea&quot;, tbl1, overwrite=TRUE) dbWriteTable(con, &quot;paf&quot;, tbl2, overwrite=TRUE) dbDisconnect(con) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_prevalences.duckdb&quot;, read_only=FALSE) if(dir.exists(&quot;data/parquet_prevalences/&quot;)) fs::dir_delete(&quot;data/parquet_prevalences/&quot;) if(!dir.exists(&quot;data/parquet_prevalences/&quot;)) dir.create(&quot;data/parquet_prevalences/&quot;) dbSendQuery(con, &quot;EXPORT DATABASE &#39;data/parquet_prevalences/&#39; (FORMAT PARQUET);&quot;) dbDisconnect(conn = con) 5.8 Costs Next we are going to calculate sleep apnea costs to all countries. Method to estimate sleep apnea cost is applied from the article Ameni et al. (2019) Cost-of-illness study of Obstructive Sleep Apnea Syndrome (OSAS) in Italy. Firstly open a database connection. We need two datasets OSA dataset slapnea for calculating population absolute values and prevalences dataset which we created in last chapter. library(duckdb) library(arrow) library(dplyr) ## Using arrow ----- # Reads Parquet File to an Arrow Table # arrow_slapnea &lt;- arrow::read_parquet(&quot;data/parquet/3_slapnea.parquet&quot;, as_data_frame = FALSE) # arrow_prevalences &lt;- arrow::read_parquet(&quot;data/parquet_prevalences/0_prevalences.parquet&quot;, as_data_frame = FALSE) # # # Gets Database Connection # con &lt;- dbConnect(duckdb::duckdb()) # # # Registers arrow table as a DuckDB view # arrow::to_duckdb(arrow_slapnea, table_name = &quot;slapnea&quot;, con = con) # arrow::to_duckdb(arrow_prevalences, table_name = &quot;prevalences&quot;, con = con) # ## Using duckdb ----- con &lt;- dbConnect(duckdb::duckdb(), dbdir=&quot;data/sleep22_prevalences.duckdb&quot;, read_only=TRUE) duckdb::dbListTables(con) ## [1] &quot;paf&quot; &quot;prevalences&quot; &quot;slapnea&quot; ## Slapnea OSA absolute base data tbl(con, &quot;slapnea&quot;) %&gt;% collect() -&gt; slapnea 5.8.1 Per Country Formulas to total costs are tbl(con, &quot;prevalences&quot;) %&gt;% mutate( ## Formulas prevalent_cases = value * pop_both, prevalent_cases_influenced_osa = PAF * prevalent_cases, direct_cost = prevalent_cases_influenced_osa * annual_direct_healthcare_cost, direct_non_healthcare_cost = prevalent_cases_influenced_osa * annual_direct_nonhealthcare_cost, productivity_lost_cost = prevalent_cases_influenced_osa * annual_productivity_losses_cost ) %&gt;% mutate(direct_cost = ifelse(is.na(direct_cost), 0 , direct_cost), direct_non_healthcare_cost = ifelse(is.na(direct_non_healthcare_cost), 0 , direct_non_healthcare_cost), productivity_lost_cost = ifelse(is.na(productivity_lost_cost), 0 , productivity_lost_cost), total_costs = direct_cost + direct_non_healthcare_cost + productivity_lost_cost) %&gt;% collect() -&gt; slapnea_costs 5.8.2 Per Patient Formulas for per patient costs are ## Calculate sums of direct, non healthcare and productivity lost costs. slapnea_costs %&gt;% group_by(location_name, pop_female, pop_male) %&gt;% summarise(direct_cost = sum(direct_cost, na.rm = T), direct_non_healthcare_cost = sum(direct_non_healthcare_cost, na.rm = T), productivity_lost_cost = sum(productivity_lost_cost, na.rm = T)) -&gt; summary_slapnea_costs ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;pop_female&#39;. You can override using the `.groups` argument. ## Calculate per patient cost ## by calculating absolute values (population) using OSA table (slapnea) summary_slapnea_costs %&gt;% mutate( ## Formulas ## TODO: tarkista absolute_value_severe_moderate = ( (pop_female * slapnea$rate[slapnea$var == &quot;Moderate&quot; &amp; slapnea$gender == &quot;Female&quot;]) + (pop_female * slapnea$rate[slapnea$var == &quot;Severe&quot; &amp; slapnea$gender == &quot;Female&quot;]) + (pop_male * slapnea$rate[slapnea$var == &quot;Moderate&quot; &amp; slapnea$gender == &quot;Male&quot;]) + (pop_male * slapnea$rate[slapnea$var == &quot;Severe&quot; &amp; slapnea$gender == &quot;Male&quot;])), absolute_value_mild = ( pop_female * slapnea$rate[slapnea$var == &quot;Mild&quot; &amp; slapnea$gender == &quot;Female&quot;] + pop_male * slapnea$rate[slapnea$var == &quot;Mild&quot; &amp; slapnea$gender == &quot;Male&quot;] ), patient_direct_cost = direct_cost / absolute_value_severe_moderate, patient_nonhealthcare_cost = direct_non_healthcare_cost / absolute_value_mild, patient_productivity_cost = productivity_lost_cost / absolute_value_mild, patient_total_cost = patient_direct_cost + patient_nonhealthcare_cost + patient_productivity_cost ) -&gt; summary_slapnea_costs 5.8.3 Add Money index to the calculation # TODO find a good index for money to all included countries ## First try HICP index, what countries are included ----- ## https://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=prc_hicp_aind&amp;lang=en hicp &lt;- readxl::read_xls(&quot;data/prc_hicp_aind.xls&quot;) hicp$`GEO/TIME`[hicp$`GEO/TIME` == &quot;Germany (until 1990 former territory of the FRG)&quot;] &lt;- &quot;Germany&quot; ## change name of the country # ## Check countries # unique(prevalences_final$location_name) # unique(hicp$`GEO/TIME`) # tmp &lt;- sort(unique(prevalences_final$location_name)) # tmp2 &lt;- sort(unique(hicp$`GEO/TIME`)) # tmp[tmp %in% tmp2] # these are found # tmp[!tmp %in% tmp2] # these are NOT # ## Missing countries # # [1] &quot;Albania&quot; &quot;Andorra&quot; &quot;Armenia&quot; &quot;Azerbaijan&quot; &quot;Belarus&quot; # # [6] &quot;Bosnia and Herzegovina&quot; &quot;Georgia&quot; &quot;Kazakhstan&quot; &quot;Monaco&quot; # # [11] &quot;Montenegro&quot; &quot;Republic of Moldova&quot; &quot;Russian Federation&quot; &quot;San Marino&quot; &quot;Ukraine&quot; ## Calculate correction index to all other countries hicp %&gt;% filter(`GEO/TIME` %in% unique(prevalences_final$location_name)) %&gt;% rename(location_name = `GEO/TIME`) %&gt;% select(location_name, `2019`) %&gt;% mutate(index = `2019` / hicp$`2019`[hicp$`GEO/TIME` == &quot;Italy&quot;]) %&gt;% select(location_name, index) -&gt; money_correction ## Make correction slapnea_costs %&gt;% left_join(money_correction, by = &quot;location_name&quot;) %&gt;% mutate(corrected = ifelse(is.na(index), FALSE, TRUE), index = ifelse(is.na(index), 1, index), direct_cost = direct_cost * index, direct_non_healthcare_cost = direct_non_healthcare_cost * index, productivity_lost_cost = productivity_lost_cost * index, total_costs = direct_cost + direct_non_healthcare_cost + productivity_lost_cost) -&gt; slapnea_costs_money_corrected ## Calculate sums of direct, non healthcare and productivity lost costs. slapnea_costs_money_corrected %&gt;% group_by(location_name, pop_female, pop_male) %&gt;% summarise(direct_cost = sum(direct_cost, na.rm = T), direct_non_healthcare_cost = sum(direct_non_healthcare_cost, na.rm = T), productivity_lost_cost = sum(productivity_lost_cost, na.rm = T)) -&gt; summary_slapnea_costs_money_corrected ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;pop_female&#39;. You can override using the `.groups` argument. ## Calculate per patient cost ## by calculating absolute values (population) using OSA table (slapnea) summary_slapnea_costs_money_corrected %&gt;% mutate( ## Formulas ## TODO: tarkista absolute_value_severe_moderate = ( (pop_female * slapnea$rate[slapnea$var == &quot;Moderate&quot; &amp; slapnea$gender == &quot;Female&quot;]) + (pop_female * slapnea$rate[slapnea$var == &quot;Severe&quot; &amp; slapnea$gender == &quot;Female&quot;]) + (pop_male * slapnea$rate[slapnea$var == &quot;Moderate&quot; &amp; slapnea$gender == &quot;Male&quot;]) + (pop_male * slapnea$rate[slapnea$var == &quot;Severe&quot; &amp; slapnea$gender == &quot;Male&quot;])), absolute_value_mild = ( pop_female * slapnea$rate[slapnea$var == &quot;Mild&quot; &amp; slapnea$gender == &quot;Female&quot;] + pop_male * slapnea$rate[slapnea$var == &quot;Mild&quot; &amp; slapnea$gender == &quot;Male&quot;] ), patient_direct_cost = direct_cost / absolute_value_severe_moderate, patient_nonhealthcare_cost = direct_non_healthcare_cost / absolute_value_mild, patient_productivity_cost = productivity_lost_cost / absolute_value_mild, patient_total_cost = patient_direct_cost + patient_nonhealthcare_cost + patient_productivity_cost ) -&gt; summary_slapnea_costs_money_corrected dbDisconnect(con, shutdown=TRUE) 5.8.4 TABLE: Sleep Apnea costs DT::datatable(summary_slapnea_costs, rownames = FALSE) 5.8.5 Save dataset Saving dataset to new duckdb database and creating parquet files for longer storage. ## Write to duckdb library(duckdb) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_calculator.duckdb&quot;, read_only=FALSE) dbWriteTable(con, &quot;prevalences&quot;, prevalences_final, overwrite=TRUE) dbWriteTable(con, &quot;summary_slapnea_costs&quot;, summary_slapnea_costs, overwrite=TRUE) dbWriteTable(con, &quot;slapnea_costs&quot;, slapnea_costs, overwrite=TRUE) dbWriteTable(con, &quot;summary_slapnea_costs_corrected&quot;, summary_slapnea_costs_money_corrected, overwrite=TRUE) dbWriteTable(con, &quot;slapnea_costs_corrected&quot;, slapnea_costs_money_corrected, overwrite=TRUE) dbDisconnect(con) ## Write to parquet file con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_calculator.duckdb&quot;, read_only=FALSE) if(dir.exists(&quot;data/parquet_calculator/&quot;)) fs::dir_delete(&quot;data/parquet_calculator/&quot;) if(!dir.exists(&quot;data/parquet_calculator/&quot;)) dir.create(&quot;data/parquet_calculator/&quot;) dbSendQuery(con, &quot;EXPORT DATABASE &#39;data/parquet_calculator/&#39; (FORMAT PARQUET);&quot;) dbDisconnect(conn = con) 5.9 Validation Next we are going to validate the calculation to the article Armeni et al. (2019) Cost-of-illness study of Obstructive Sleep Apnea Syndrome (OSAS) in Italy. Because we use different data, results are going to be different, . 5.9.1 Population Population in Armeni dataset is Aged 15-74: Population Female 22 708 659 Male 22 279 959 Total 44 988 618 In our dataset from IHME data, population is a bit larger: ## Adding missing grouping variables: `location_name` ## Adding missing grouping variables: `location_name` ## # A tibble: 3 × 3 ## # Groups: location_name [1] ## location_name Population value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Italy pop_total 45304482. ## 2 Italy pop_female 22872466. ## 3 Italy pop_male 22432016. 5.9.2 Prevalences Prevalences in the article are combined from different datasources (table 9, page 37). We have a bit different prevalences which are shown below: "],["results.html", "6 Results 6.1 Direct costs 6.2 Direct non-healthcare costs 6.3 Productivity loss costs 6.4 Working on…", " 6 Results Total costs are approximally 2000 euros per patient. Maximum cost is 2900 euros per patient in Bosnia and Herzegovina. ## [1] &quot;Bosnia and Herzegovina&quot; &quot;Czech Republic&quot; ## character(0) Figure 6.1: Estimated sleep apnea costs in Europe per patient in 2019. 6.0.1 Table: cost per patient 6.1 Direct costs Figure 6.2: Estimated sleep apnea direct cost per patient in Europe. 6.1.1 Table: direct cost per patient 6.2 Direct non-healthcare costs Figure 6.3: Estimated sleep apnea direct non-healthcare cost per patient in Europe. 6.2.1 Table: direct non-healthcare cost 6.3 Productivity loss costs Figure 6.4: Estimated sleep apnea productivity losses cost per patient in Europe. 6.3.1 Table: patient productivity cost 6.4 Working on… 6.4.1 Leaflet map read: https://www.r-graph-gallery.com/183-choropleth-map-with-leaflet.html 6.4.2 Another interactive example Read https://www.r-bloggers.com/2015/05/interactive-maps-for-the-web-in-r/ 6.4.3 BASE MAP ## quartz_off_screen ## 2 6.4.4 Confident intervals ## Warning: Missing values are always removed in SQL. ## Use `mean(x, na.rm = TRUE)` to silence this warning ## This warning is displayed only once per session. "],["money-corrected-results.html", "7 Money corrected results 7.1 Direct costs 7.2 Direct non-healthcare costs 7.3 Productivity loss costs", " 7 Money corrected results Next same results with money value corrected version. Total costs are approximally 2000 euros per patient. Maximum cost is 3900 euros per patient in Turkey. Weightening is made so that Italy money value is 1 and other countries weight follows that with mean value 1.04 by statistics of Eurostat. Countries, which are weightened are ## [1] &quot;Austria&quot; &quot;Belgium&quot; &quot;Bulgaria&quot; &quot;Croatia&quot; &quot;Cyprus&quot; &quot;Denmark&quot; &quot;Estonia&quot; &quot;Finland&quot; &quot;France&quot; ## [10] &quot;Germany&quot; &quot;Greece&quot; &quot;Hungary&quot; &quot;Iceland&quot; &quot;Ireland&quot; &quot;Italy&quot; &quot;Latvia&quot; &quot;Lithuania&quot; &quot;Luxembourg&quot; ## [19] &quot;Malta&quot; &quot;Netherlands&quot; &quot;Norway&quot; &quot;Poland&quot; &quot;Portugal&quot; &quot;Romania&quot; &quot;Serbia&quot; &quot;Slovakia&quot; &quot;Slovenia&quot; ## [28] &quot;Spain&quot; &quot;Sweden&quot; &quot;Switzerland&quot; &quot;Turkey&quot; &quot;United Kingdom&quot; and following are having a weight value 1 ## [1] &quot;Albania&quot; &quot;Andorra&quot; &quot;Armenia&quot; &quot;Azerbaijan&quot; &quot;Belarus&quot; &quot;Bosnia and Herzegovina&quot; ## [7] &quot;Czech Republic&quot; &quot;Georgia&quot; &quot;Kazakhstan&quot; &quot;Macedonia&quot; &quot;Moldova&quot; &quot;Monaco&quot; ## [13] &quot;Montenegro&quot; &quot;Russia&quot; &quot;San Marino&quot; &quot;Ukraine&quot; ## [1] &quot;Bosnia and Herzegovina&quot; &quot;Czech Republic&quot; ## character(0) Figure 7.1: Estimated sleep apnea costs in Europe per patient in 2019. Figure 7.2: Total costs and per patient. Figure 7.3: Cost as direct healthcare, direct non-healthcare and productivity lost costs. 7.0.1 Table: total costs 7.1 Direct costs (#fig:plot-europe-direct-cost_corrected)Estimated sleep apnea direct cost per patient in Europe. 7.1.1 Table: direct costs 7.2 Direct non-healthcare costs Figure 7.4: Estimated sleep apnea direct non-healthcare cost per patient in Europe. 7.2.1 Table: Direct non-healthcare costs 7.3 Productivity loss costs Figure 7.5: Estimated sleep apnea productivity losses cost per patient in Europe. 7.3.1 Table: productivity loss cost "],["database-for-shiny2.html", "8 Database for Shiny2 8.1 Population from ihme 8.2 Prevalences from ihme dataset 8.3 Mortalities from ihme 8.4 Add also base values 8.5 Table: prevalences and mortalities 8.6 Excel files 8.7 Save data to new database", " 8 Database for Shiny2 In this chapter we are going to use same methods as in calculation chapter, but we are going to create database, which we can use in Shiny Application, where user can add his input values for sleep apnea prevalences, condition prevalences and costs. Data is filtered: Age 15-74 years old European countries library(duckdb) library(arrow) library(dplyr) con &lt;- dbConnect(duckdb::duckdb(), dbdir=&quot;data/sleep22.duckdb&quot;, read_only=TRUE) 8.1 Population from ihme Calculating 15-74 years old population of the countries ## Both, female and male population (15-74yrs) in wide format library(tidyr) tbl(con, &quot;pop&quot;) %&gt;% filter(age_group &gt; 14 &amp; age_group &lt; 75 &amp; year_id == 2019) %&gt;% group_by(location_name, sex_name) %&gt;% summarise(pop = sum(total_population)) %&gt;% collect() %&gt;% pivot_wider(names_from = sex_name, values_from = pop) %&gt;% rename(pop_1574_both = both, pop_1574_female = female, pop_1574_male = male) -&gt; population_1574 ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. head(population_1574) ## # A tibble: 6 × 4 ## # Groups: location_name [6] ## location_name pop_1574_both pop_1574_female pop_1574_male ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Albania 2085677. 1042814. 1042863. ## 2 Andorra 67016. 32263. 34752. ## 3 Armenia 2267463. 1187751. 1079711. ## 4 Austria 6785345. 3390812. 3394534. ## 5 Azerbaijan 7752896. 3933115. 3819781. ## 6 Belarus 7249252. 3828210. 3421042. Calculating 30 to 69 years old population ## Both, female and male population (30-69yrs) in wide format library(tidyr) tbl(con, &quot;pop&quot;) %&gt;% filter(age_group &gt; 29 &amp; age_group &lt; 70 &amp; year_id == 2019) %&gt;% group_by(location_name, sex_name) %&gt;% summarise(pop = sum(total_population)) %&gt;% collect() %&gt;% pivot_wider(names_from = sex_name, values_from = pop) %&gt;% rename(pop_3069_both = both, pop_3069_female = female, pop_3069_male = male) -&gt; population_3069 ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. head(population_3069) ## # A tibble: 6 × 4 ## # Groups: location_name [6] ## location_name pop_3069_both pop_3069_female pop_3069_male ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Albania 1359142. 692488. 666654. ## 2 Andorra 50655. 24434. 26221. ## 3 Armenia 1577767. 841499. 736268. ## 4 Austria 4794931. 2408749. 2386182. ## 5 Azerbaijan 5171784. 2660620. 2511164. ## 6 Belarus 5391554. 2875716. 2515838. # Join two population info population_age_filtered &lt;- population_1574 %&gt;% left_join(population_3069, by = &quot;location_name&quot;) Population info ## Both, female and male population (15-74yrs) in wide format library(tidyr) tbl(con, &quot;pop&quot;) %&gt;% filter(year_id == 2019) %&gt;% group_by(location_name, sex_name) %&gt;% summarise(pop = sum(total_population)) %&gt;% collect() %&gt;% pivot_wider(names_from = sex_name, values_from = pop) %&gt;% rename(pop_both = both, pop_female = female, pop_male = male) -&gt; popu_info ## `summarise()` has grouped output by &#39;location_name&#39;. You can override using the `.groups` argument. head(popu_info) ## # A tibble: 6 × 4 ## # Groups: location_name [6] ## location_name pop_both pop_female pop_male ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Albania 2720353. 1357945. 1362408. ## 2 Andorra 83064. 40430. 42634. ## 3 Armenia 3019674. 1562196. 1457478. ## 4 Austria 8916185. 4522218. 4393968. ## 5 Azerbaijan 10278674. 5136802. 5141872. ## 6 Belarus 9500785. 5072640. 4428145. 8.2 Prevalences from ihme dataset Calculating prevalences percentages by joining prevalences and population information ## Get cause_id&#39;s which base values we can use to overwrite from IHME data tbl(con, &quot;paf&quot;) %&gt;% filter(type == &quot;prevalence&quot;) %&gt;% # TODO check if this is right! select(cause_id) %&gt;% collect() -&gt; causes causes &lt;- causes$cause_id[!is.na(causes$cause_id)] ## Get number of prevalences per location and causes from IHME (age: 15-74 and sex: both) tbl(con, &quot;ihme&quot;) %&gt;% filter(cause_id %in% causes &amp; metric_name == &quot;Number&quot; &amp; age_id &gt; 7 &amp; age_id &lt; 20 &amp; sex_id == 3) %&gt;% group_by(location_name, cause_id, cause_name) %&gt;% summarise(prevalence_number = sum(val)) %&gt;% arrange(location_name, cause_id) %&gt;% collect() -&gt; prevalences_ihme ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;cause_id&#39;. You can override using the `.groups` argument. ## Calculate Prevalence Rates: join tables prevalences_ihme &amp; population_age_filtered prevalences_ihme %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) %&gt;% mutate(prevalence = prevalence_number / pop_1574_both) %&gt;% select(location_name, cause_id, cause_name, prevalence) -&gt; prevalences_ihme head(prevalences_ihme) ## # A tibble: 6 × 4 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name prevalence ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 369 Maternal hypertensive disorders 0.00142 ## 2 Albania 493 Ischemic heart disease 0.0376 ## 3 Albania 494 Stroke 0.0168 ## 4 Albania 536 Gastroesophageal reflux disease 0.137 ## 5 Albania 619 Endocrine, metabolic, blood, and immune disorders 0.0919 ## 6 Albania 670 Glaucoma 0.000380 8.3 Mortalities from ihme Calculating mortalities for two diseases and calculating percentages by joining mortality and population information 1023 Other cardiovascular and circulatory diseases 294 All causes ## Get cause_id&#39;s which base values we can use to overwrite from IHME data tbl(con, &quot;paf&quot;) %&gt;% filter(type == &quot;mortality&quot;) %&gt;% select(cause_id) %&gt;% collect() -&gt; causes causes &lt;- causes$cause_id[!is.na(causes$cause_id)] ## Get mortality values from ihme tbl(con, &quot;ihme&quot;) %&gt;% filter(cause_id %in% causes &amp; measure_name == &quot;Deaths&quot; &amp; metric_name == &quot;Number&quot; &amp; age_id &gt; 7 &amp; age_id &lt; 20 &amp; sex_id == 3) %&gt;% group_by(location_name, cause_id, cause_name) %&gt;% summarise(mortality_number = sum(val)) %&gt;% arrange(location_name, cause_id) %&gt;% collect() -&gt; mortalities_ihme ## `summarise()` has grouped output by &#39;location_name&#39;, &#39;cause_id&#39;. You can override using the `.groups` argument. ## Calculate Rates: join tables mortalities_ihme &amp; population_age_filtered mortalities_ihme %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) %&gt;% mutate(mortality = mortality_number / pop_1574_both) %&gt;% select(location_name, cause_id, cause_name, mortality) -&gt; mortalities_ihme head(mortalities_ihme) ## # A tibble: 6 × 4 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name mortality ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 294 All causes 0.00423 ## 2 Albania 1023 Other cardiovascular and circulatory diseases 0.0000757 ## 3 Andorra 294 All causes 0.00351 ## 4 Andorra 1023 Other cardiovascular and circulatory diseases 0.0000173 ## 5 Armenia 294 All causes 0.00573 ## 6 Armenia 1023 Other cardiovascular and circulatory diseases 0.0000190 ## Join mortalities and prevalance data. Add name to describe value and rename &#39;mortality&#39;/&#39;prevalence&#39; to &#39;value&#39;. prevalences_ihme$type &lt;- &quot;prevalence&quot; mortalities_ihme$type &lt;- &quot;mortality&quot; ihme &lt;- prevalences_ihme %&gt;% rbind(mortalities_ihme) %&gt;% mutate(ihme = ifelse(is.na(prevalence), mortality, prevalence)) %&gt;% select(location_name, cause_id, cause_name, type, ihme) %&gt;% arrange(location_name, type, cause_id) head(ihme) ## # A tibble: 6 × 5 ## # Groups: location_name, cause_id [6] ## location_name cause_id cause_name type ihme ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Albania 294 All causes mortality 0.00423 ## 2 Albania 1023 Other cardiovascular and circulatory diseases mortality 0.0000757 ## 3 Albania 369 Maternal hypertensive disorders prevalence 0.00142 ## 4 Albania 493 Ischemic heart disease prevalence 0.0376 ## 5 Albania 494 Stroke prevalence 0.0168 ## 6 Albania 536 Gastroesophageal reflux disease prevalence 0.137 rm(list=c(&quot;mortalities_ihme&quot;, &quot;prevalences_ihme&quot;)) 8.4 Add also base values Base data (from excel) and country specific prevalences &amp; mortalities ## Base data. We need paf info for every country prevalences_base &lt;- NULL for(cntry in unique(ihme$location_name)){ # print(cntry) tbl(con, &quot;paf&quot;) %&gt;% collect() %&gt;% mutate(location_name = cntry, condition = Conditon) %&gt;% select(&quot;location_name&quot;, &quot;cause_id&quot;, &quot;condition&quot;, &quot;PAF&quot;, &quot;prevalence_base_italy&quot;, &quot;annual_direct_healthcare_cost&quot;, &quot;annual_direct_nonhealthcare_cost&quot;, &quot;annual_productivity_losses_cost&quot;) %&gt;% rbind(prevalences_base) -&gt; prevalences_base } head(prevalences_base) ## # A tibble: 6 × 8 ## location_name cause_id condition PAF prevalence_base_italy annual_direct_healthcare_cost annual_direct_nonhealthcare_cost annual_producti… ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 United Kingdom 294 All-cause mortality Severe 0.075 0.003 NA NA NA ## 2 United Kingdom 1023 Cardiovascular mortality Severe 0.227 NA NA NA NA ## 3 United Kingdom 1029 Cancer Overall 0.097 0.042 5718 4581 119 ## 4 United Kingdom NA Diabetic retinopathy Overall* 0.207 0.026 307 242 579 ## 5 United Kingdom 998 Diabetic kidney disease Overall* 0.135 0.015 797 NA NA ## 6 United Kingdom 976 Type 2 diabetes 0.145 0.068 3866 NA 4352 With base values, join new calculated prevalences/mortalities from IHME ## Join base data and new calculated prevalences prevalences_final &lt;- prevalences_base %&gt;% left_join(ihme, by = c(&quot;location_name&quot;, &quot;cause_id&quot;)) %&gt;% # mutate(value = ifelse(is.na(value), prevalence_base_italy, value)) %&gt;% select(location_name, cause_id, cause_name, condition, type,ihme, prevalence_base_italy, PAF, annual_direct_healthcare_cost, annual_direct_nonhealthcare_cost, annual_productivity_losses_cost) %&gt;% right_join(population_age_filtered, by = &quot;location_name&quot;) ## Add the population to all rows head(prevalences_final) ## # A tibble: 6 × 17 ## location_name cause_id cause_name condition type ihme prevalence_base… PAF annual_direct_h… annual_direct_n… annual_producti… pop_1574_both pop_1574_female ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 United Kingdom 294 All causes All-caus… mort… 4.02e-3 0.003 0.075 NA NA NA 49854207. 25024325. ## 2 United Kingdom 1023 Other card… Cardiova… mort… 4.97e-5 NA 0.227 NA NA NA 49854207. 25024325. ## 3 United Kingdom 1029 Total canc… Cancer O… prev… 3.80e-2 0.042 0.097 5718 4581 119 49854207. 25024325. ## 4 United Kingdom NA &lt;NA&gt; Diabetic… &lt;NA&gt; NA 0.026 0.207 307 242 579 49854207. 25024325. ## 5 United Kingdom 998 Chronic ki… Diabetic… prev… 1.28e-2 0.015 0.135 797 NA NA 49854207. 25024325. ## 6 United Kingdom 976 Diabetes m… Type 2 d… prev… 1.32e-1 0.068 0.145 3866 NA 4352 49854207. 25024325. ## # … with 4 more variables: pop_1574_male &lt;dbl&gt;, pop_3069_both &lt;dbl&gt;, pop_3069_female &lt;dbl&gt;, pop_3069_male &lt;dbl&gt; 8.5 Table: prevalences and mortalities DT::datatable(prevalences_final, rownames = FALSE) 8.6 Excel files ## Read from source excel tbl1 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl1&quot;) tbl2 &lt;- readxl::read_xlsx(&quot;data/osa_tables.xlsx&quot;, sheet = &quot;tbl2&quot;) 8.6.1 OSA values from article ### TODO left here, get prevelance data for slider library(data.table) ## data.table 1.14.2 using 1 threads (see ?getDTthreads). Latest news: r-datatable.com ## ********** ## This installation of data.table has not detected OpenMP support. It should still work but in single-threaded mode. ## This is a Mac. Please read https://mac.r-project.org/openmp/. Please engage with Apple and ask them for support. Check r-datatable.com for updates, and our Mac instructions here: https://github.com/Rdatatable/data.table/wiki/Installation. After several years of many reports of installation problems on Mac, it&#39;s time to gingerly point out that there have been no similar problems on Windows or Linux. ## ********** ## ## Attaching package: &#39;data.table&#39; ## The following objects are masked from &#39;package:dplyr&#39;: ## ## between, first, last ## The following object is masked from &#39;package:purrr&#39;: ## ## transpose ## Sleep apnea prevalences tbl3 &lt;- readxl::read_xlsx(&quot;data/osa_prevalence_country_specific.xlsx&quot;, sheet = &quot;final&quot;) tbl3$country ## [1] &quot;Afghanistan&quot; &quot;Albania&quot; &quot;Algeria&quot; &quot;Angola&quot; ## [5] &quot;Antigua and Barbuda&quot; &quot;Argentina&quot; &quot;Armenia&quot; &quot;Aruba&quot; ## [9] &quot;Australia&quot; &quot;Austria&quot; &quot;Azerbaijan&quot; &quot;Bahamas&quot; ## [13] &quot;Bahrain&quot; &quot;Bangladesh&quot; &quot;Barbados&quot; &quot;Belarus&quot; ## [17] &quot;Belgium&quot; &quot;Belize&quot; &quot;Benin&quot; &quot;Bhutan&quot; ## [21] &quot;Bolivia&quot; &quot;Bosnia and Herzegovina&quot; &quot;Botswana&quot; &quot;Brazil&quot; ## [25] &quot;Brunei&quot; &quot;Bulgaria&quot; &quot;Burkina Faso&quot; &quot;Burundi&quot; ## [29] &quot;Cape Verde&quot; &quot;Cambodia&quot; &quot;Cameroon&quot; &quot;Canada&quot; ## [33] &quot;Central African Republic&quot; &quot;Chad&quot; &quot;Chile&quot; &quot;China&quot; ## [37] &quot;Colombia&quot; &quot;Comoros&quot; &quot;Congo&quot; &quot;Costa Rica&quot; ## [41] &quot;Côte d&#39;Ivoire&quot; &quot;Croatia&quot; &quot;Cuba&quot; &quot;Curacao&quot; ## [45] &quot;Cyprus&quot; &quot;Czech Republic&quot; &quot;Democratic Republic of the Congo&quot; &quot;Denmark&quot; ## [49] &quot;Djibouti&quot; &quot;Dominican Republic&quot; &quot;Ecuador&quot; &quot;Egypt&quot; ## [53] &quot;El Salvador&quot; &quot;Equatorial Guinea&quot; &quot;Eritrea&quot; &quot;Estonia&quot; ## [57] &quot;eSwatini&quot; &quot;Ethiopia&quot; &quot;Federated States of Micronesia&quot; &quot;Fiji&quot; ## [61] &quot;Finland&quot; &quot;France&quot; &quot;French Polynesia&quot; &quot;Gabon&quot; ## [65] &quot;Gambia&quot; &quot;Georgia&quot; &quot;Germany&quot; &quot;Ghana&quot; ## [69] &quot;Greece&quot; &quot;Grenada&quot; &quot;Guam&quot; &quot;Guatemala&quot; ## [73] &quot;Guinea&quot; &quot;Guinea-Bissau&quot; &quot;Guyana&quot; &quot;Haiti&quot; ## [77] &quot;Honduras&quot; &quot;Hong Kong&quot; &quot;Hungary&quot; &quot;Iceland&quot; ## [81] &quot;India&quot; &quot;Indonesia&quot; &quot;Iran&quot; &quot;Iraq&quot; ## [85] &quot;Ireland&quot; &quot;Israel&quot; &quot;Italy&quot; &quot;Jamaica&quot; ## [89] &quot;Japan&quot; &quot;Jordan&quot; &quot;Kazakhstan&quot; &quot;Kenya&quot; ## [93] &quot;Kiribati&quot; &quot;Kuwait&quot; &quot;Kyrgyzstan&quot; &quot;Laos&quot; ## [97] &quot;Latvia&quot; &quot;Lebanon&quot; &quot;Lesotho&quot; &quot;Liberia&quot; ## [101] &quot;Libya&quot; &quot;Lithuania&quot; &quot;Luxembourg&quot; &quot;Macao&quot; ## [105] &quot;Macedonia&quot; &quot;Madagascar&quot; &quot;Malawi&quot; &quot;Malaysia&quot; ## [109] &quot;Maldives&quot; &quot;Mali&quot; &quot;Malta&quot; &quot;Mauritania&quot; ## [113] &quot;Mauritius&quot; &quot;Mexico&quot; &quot;Moldova&quot; &quot;Mongolia&quot; ## [117] &quot;Montenegro&quot; &quot;Morocco&quot; &quot;Mozambique&quot; &quot;Namibia&quot; ## [121] &quot;Nepal&quot; &quot;Netherlands&quot; &quot;New Caledonia&quot; &quot;New Zealand&quot; ## [125] &quot;Nicaragua&quot; &quot;Niger&quot; &quot;Nigeria&quot; &quot;North Korea&quot; ## [129] &quot;Norway&quot; &quot;Oman&quot; &quot;Pakistan&quot; &quot;Panama&quot; ## [133] &quot;Papua New Guinea&quot; &quot;Paraguay&quot; &quot;Peru&quot; &quot;Philippines&quot; ## [137] &quot;Poland&quot; &quot;Portugal&quot; &quot;Puerto Rico&quot; &quot;Qatar&quot; ## [141] &quot;Romania&quot; &quot;Russia&quot; &quot;Rwanda&quot; &quot;Saint Lucia&quot; ## [145] &quot;Saint Vincent and the Grenadines&quot; &quot;Samoa&quot; &quot;São Tomé and Principe&quot; &quot;Saudi Arabia&quot; ## [149] &quot;Senegal&quot; &quot;Serbia&quot; &quot;Seychelles&quot; &quot;Sierra Leone&quot; ## [153] &quot;Singapore&quot; &quot;Slovakia&quot; &quot;Slovenia&quot; &quot;Solomon Islands&quot; ## [157] &quot;Somalia&quot; &quot;South Africa&quot; &quot;South Korea&quot; &quot;South Sudan&quot; ## [161] &quot;Spain&quot; &quot;Sri Lanka&quot; &quot;Sudan&quot; &quot;Suriname&quot; ## [165] &quot;Sweden&quot; &quot;Switzerland&quot; &quot;Syria&quot; &quot;Taiwan&quot; ## [169] &quot;Tajikistan&quot; &quot;Tanzania&quot; &quot;Thailand&quot; &quot;Timor Leste&quot; ## [173] &quot;Togo&quot; &quot;Tonga&quot; &quot;Trinidad and Tobago&quot; &quot;Tunisia&quot; ## [177] &quot;Turkey&quot; &quot;Turkmenistan&quot; &quot;Uganda&quot; &quot;Ukraine&quot; ## [181] &quot;United Arab Emirates&quot; &quot;United Kingdom&quot; &quot;USA&quot; &quot;Uruguay&quot; ## [185] &quot;Uzbekistan&quot; &quot;Vanuatu&quot; &quot;Venezuela&quot; &quot;Vietnam&quot; ## [189] &quot;Virgin Islands&quot; &quot;Western Sahara&quot; &quot;Yemen&quot; &quot;Zambia&quot; ## [193] &quot;Zimbabwe&quot; ## How many countries are needed length(unique(ihme$location_name)) ## [1] 48 ## Check which countries are not included in excel length(tbl3$country[tbl3$country %in% unique(ihme$location_name)]) ## [1] 45 ## 3 countries missing, check names which are missing unique(ihme$location_name)[!unique(ihme$location_name) %in% tbl3$country] ## [1] &quot;Andorra&quot; &quot;Monaco&quot; &quot;San Marino&quot; ## these are not included # [1] &quot;Andorra&quot; &quot;Monaco&quot; &quot;San Marino&quot; ## Filter dataset and Calculate Mild, Moderate, Severe values separately tbl3 &lt;-tbl3 %&gt;% filter(country %in% unique(ihme$location_name)) %&gt;% mutate( Mild = `Mild-Moderate-Severe` - `Moderate-Severe`, `Male_Moderate-Severe` = 1.3823 * `Moderate-Severe`, # Gender proportion is calculated from Italy data from Armeni article data `Female_Moderate-Severe` = 0.6508 * `Moderate-Severe`, # Gender proportion is calculated from Italy data from Armeni article data Male_Mild = 0.9519 * Mild, # Gender proportion is calculated from Italy data from Armeni article data Female_Mild = 1.0440 * Mild # Gender proportion is calculated from Italy data from Armeni article data ) tbl3 &lt;- tbl3 %&gt;% mutate( ## TODO check these with comments Female_Moderate = 0.5342 * `Female_Moderate-Severe`, # Moderate proportion percentage is calculated from Italy data from Armeni article data Female_Severe = 0.4658 * `Female_Moderate-Severe`, # Severe proportion percentage is calculated from Italy data from Armeni article data Male_Moderate = 0.4004 * `Male_Moderate-Severe`, # Moderate proportion percentage is calculated from Italy data from Armeni article data Male_Severe = 0.5996 * `Male_Moderate-Severe` ) ## To longer format library(tidyr) tbl3 &lt;- tbl3 %&gt;% tidyr::pivot_longer(c(`Male_Moderate-Severe`, `Female_Moderate-Severe`, `Female_Moderate`, `Female_Severe`, `Male_Moderate`, `Male_Severe`, Male_Mild, Female_Mild), names_to = &quot;var&quot;) %&gt;% rename(rate=value, location_name = country) %&gt;% mutate( ## Get gender and var right gender = sub(&quot;_.*&quot;, &quot;&quot;, var), var = sub(&#39;.+_(.+)&#39;, &#39;\\\\1&#39;, var) ) %&gt;% select(location_name, var, gender, rate) dbDisconnect(con, shutdown=TRUE) 8.7 Save data to new database library(duckdb) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_shiny.duckdb&quot;, read_only=FALSE) dbWriteTable(con, &quot;prevalences&quot;, prevalences_final, overwrite=TRUE) dbWriteTable(con, &quot;pop&quot;, population_age_filtered, overwrite=TRUE) dbWriteTable(con, &quot;popu_info&quot;, popu_info, overwrite=TRUE) dbWriteTable(con, &quot;osa&quot;, tbl1, overwrite=TRUE) dbWriteTable(con, &quot;osanew&quot;, tbl3, overwrite=TRUE) # dbWriteTable(con, &quot;paf&quot;, tbl2, overwrite=TRUE) dbDisconnect(con) con = dbConnect(duckdb::duckdb(), dbdir=&quot;./data/sleep22_shiny.duckdb&quot;, read_only=FALSE) if(dir.exists(&quot;data/parquet_shiny/&quot;)) fs::dir_delete(&quot;data/parquet_shiny/&quot;) if(!dir.exists(&quot;data/parquet_shiny/&quot;)) dir.create(&quot;data/parquet_shiny/&quot;) dbSendQuery(con, &quot;EXPORT DATABASE &#39;data/parquet_shiny/&#39; (FORMAT PARQUET);&quot;) dbDisconnect(conn = con) ## Copy newdb to sleep22calculator fils &lt;- c(paste0(here::here(), &quot;/data/sleep22_shiny.duckdb&quot;), paste0(here::here(), &quot;/data/sleep22_shiny.duckdb.wal&quot;)) fs::file_copy(fils, &quot;/Users/japmiett/projects/sleep22calculator/&quot;, overwrite = T) "],["create-datas-for-visualizer.html", "9 Create datas for Visualizer", " 9 Create datas for Visualizer ## Data without correction ---- con &lt;- dbConnect(duckdb::duckdb(), dbdir=&quot;data/sleep22_calculator.duckdb&quot;, read_only=TRUE) duckdb::dbListTables(conn = con) slapnea22 &lt;- tbl(con, &quot;summary_slapnea_costs&quot;) %&gt;% collect() dbDisconnect(con, shutdown=TRUE) ## Write to calculation database saveRDS(slapnea22, file = &quot;data/slapnea22.RDS&quot;) ## EuroStat correction ----- con &lt;- dbConnect(duckdb::duckdb(), dbdir=&quot;data/sleep22_calculator.duckdb&quot;, read_only=TRUE) slapnea22_eurostat &lt;- tbl(con, &quot;summary_slapnea_costs_corrected&quot;) %&gt;% collect() dbDisconnect(con, shutdown=TRUE) ## Write to calculation database saveRDS(slapnea22_eurostat, file = &quot;data/slapnea22_eurostat.RDS&quot;) ## Data for map ----- # Read this shape file with the rgdal library. library(rgdal) world_spdf &lt;- readOGR( dsn= paste0(getwd(),&quot;/data/map/&quot;) , layer=&quot;TM_WORLD_BORDERS_SIMPL-0.3&quot;, verbose=FALSE ) ## Countries in our data countries &lt;- tbl(con, &quot;summary_slapnea_costs&quot;) %&gt;% group_by(location_name) %&gt;% summarise(1) %&gt;% collect() countries &lt;- countries$location_name ## Countries in world data sort(world_spdf$NAME) ## Rename few countries in world data and subset world_spdf$NAME[world_spdf$NAME == &quot;The former Yugoslav Republic of Macedonia&quot;] &lt;- &quot;Macedonia&quot; world_spdf$NAME[world_spdf$NAME == &quot;Republic of Moldova&quot; ] &lt;- &quot;Moldova&quot; europe_spdf &lt;- subset(world_spdf, world_spdf$NAME %in% countries) countries[!countries %in% europe_spdf$NAME] ## Write to calculation database saveRDS(europe_spdf, file = &quot;data/europe_spdf.RDS&quot;) # slapnea22_eurostat &lt;- sp::merge(europe_spdf, d1, by.x=&quot;NAME&quot;, by.y=&quot;location_name&quot;) ## Copy to sleep22visualizer fils &lt;- c(paste0(here::here(), &quot;/data/europe_spdf.RDS&quot;), paste0(here::here(), &quot;/data/slapnea22.RDS&quot;), paste0(here::here(), &quot;/data/slapnea22_eurostat.RDS&quot;)) fs::file_copy(fils, &quot;/Users/japmiett/projects/sleep22visualizer/data/&quot;, overwrite = T) "],["interactive-applications.html", "10 Interactive applications 10.1 Map visualization 10.2 Calculator", " 10 Interactive applications 10.1 Map visualization URL: https://janimiettinen.shinyapps.io/sleepapneacost/ 10.2 Calculator URL: https://janimiettinen.shinyapps.io/sleepapneacalculator/ "],["side-project.html", "11 Side project", " 11 Side project This project is systematically documented by using bookdown package. Bookdown is a package, which helps to write chapters and documents in R. We are also finding best practices on working with many/large csv-datasets by using packages such as fs and vroom, tidyverse and duckdb. Memos Github project "],["references.html", "12 References", " 12 References Bookdown package duckdb ghdx healthdata Estimation source Index correction datas https://ec.europa.eu/eurostat/web/hicp/data/database "],["next-task.html", "13 Next task? 13.1 Shiny App &amp; todo ideas 13.2 testing 13.3 web page and shiny", " 13 Next task? 13.1 Shiny App &amp; todo ideas play with the excel version We need to identify prevalences which to use in calculator and collect information with population dataset into good format. This we will use at Shiny app. calculate cause prevalences to all eu countries calculate cost to all eu countries create a map visualization Check countries. Add Moldova Lock prevalance base values Money index correction create a simple version of a calculator in shiny 13.2 testing getwd() ## [1] &quot;/Users/japmiett/projects/sleep22/temp&quot; here::here() ## [1] &quot;/Users/japmiett/projects/sleep22&quot; 13.3 web page and shiny https://bookdown.org/yihui/bookdown/web-pages-and-shiny-apps.html "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
